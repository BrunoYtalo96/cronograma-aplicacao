<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cronograma de Aplicações e Exames</title>
  <link rel="icon" type="image/png" href="seringa.png">
  <style>
    /* Tema Dark com Background Fixo */
    :root {
      --primary-color: #007bff;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --bg-color: #1a1a1a;
      --card-bg: #2b2b2b;
      --text-color: #f1f1f1;
      --secondary-text-color: #aaaaaa;
      --border-color: #444444;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 30px 15px;
      color: var(--text-color);
      background-color: #1a1a1a;
      background-image: url('fundo1.jpg');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      line-height: 1.6;
    }

    h1, h2 {
      text-align: center;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.7);
    }

    h1 { color: var(--primary-color); margin-bottom: 5px; font-weight: 600; }
    h2 { color: var(--text-color); margin-top: 40px; margin-bottom: 15px; font-weight: 500; }
    p  { text-align: center; margin-bottom: 30px; color: var(--secondary-text-color); }

    table {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 12px;
      overflow: hidden;
      background-color: rgba(43, 43, 43, 0.95);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }

    thead th {
      background-color: var(--primary-color);
      color: white;
      padding: 15px 10px;
      text-transform: uppercase;
      font-size: 0.85rem;
      font-weight: 700;
      border: none;
    }

    td {
      padding: 12px 10px;
      border-top: 1px solid var(--border-color);
      text-align: center;
    }

    tbody tr:nth-child(even) {
      background-color: rgba(51, 51, 51, 0.95);
    }

    tbody tr:hover {
      background-color: #3a3a3a;
    }

    .status-cell {
      font-weight: 600;
      cursor: pointer;
      padding: 8px 10px;
      border-radius: 6px;
      user-select: none;
      transition: background-color 0.4s ease, transform 0.2s ease-out;
      transform: scale(1);
      color: white;
    }

    .status-cell:active { transform: scale(0.95); opacity: 0.9; }
    .status-cell.animating { transform: scale(1.1); opacity: 0.7; }
    .applied { background-color: var(--success-color); }
    .not-applied { background-color: var(--danger-color); }

    @media (max-width: 768px) {
      table { width: 100%; font-size: 0.9rem; }
      th, td { padding: 8px 5px; }
    }
  </style>
</head>
<body>

  <h1>Cronograma de Aplicações - 9 Semanas</h1>
  <p>Clique nas células de status (vermelhas ou verdes) para registrar o progresso.</p>

  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Semana</th>
        <th>Segunda-feira (125mg)</th>
        <th>Status</th>
        <th>Quinta-feira (125mg)</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="scheduleBody"></tbody>
  </table>

  <h2>Acompanhamento de Exames</h2>
  <table id="examTable">
    <thead>
      <tr><th>Tipo de exame</th><th>Data</th><th>Status</th></tr>
    </thead>
    <tbody id="examBody"></tbody>
  </table>

  <script>
    const API_APLICACOES = "https://json-h24wunlqn-bruno-ytalos-projects.vercel.app";
    const API_EXAMES = "https://json-h24wunlqn-bruno-ytalos-projects.vercel.app";

    async function carregarTabelas() {
      const [aplicacoesRes, examesRes] = await Promise.all([
        fetch(API_APLICACOES),
        fetch(API_EXAMES)
      ]);

      const aplicacoes = await aplicacoesRes.json();
      const exames = await examesRes.json();

      const scheduleBody = document.getElementById('scheduleBody');
      const examBody = document.getElementById('examBody');

      scheduleBody.innerHTML = '';
      examBody.innerHTML = '';

      // Monta tabela de aplicações
      for (let i = 0; i < aplicacoes.length; i += 2) {
        const row = document.createElement('tr');
        const semana = aplicacoes[i].semana;
        const seg = aplicacoes[i];
        const qui = aplicacoes[i + 1];

        row.innerHTML = `
          <td>${semana}</td>
          <td>${seg.dia}</td>
          <td class="status-cell ${seg.status === 'aplicado' ? 'applied' : 'not-applied'}" data-id="${seg.id}" data-type="aplicacao">
            ${seg.status === 'aplicado' ? 'Aplicado' : 'Não Aplicado'}
          </td>
          <td>${qui.dia}</td>
          <td class="status-cell ${qui.status === 'aplicado' ? 'applied' : 'not-applied'}" data-id="${qui.id}" data-type="aplicacao">
            ${qui.status === 'aplicado' ? 'Aplicado' : 'Não Aplicado'}
          </td>
        `;
        scheduleBody.appendChild(row);
      }

      // Monta tabela de exames
      exames.forEach(exame => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${exame.tipo}</td>
          <td>${exame.data}</td>
          <td class="status-cell ${exame.status === 'feito' ? 'applied' : 'not-applied'}" data-id="${exame.id}" data-type="exame">
            ${exame.status === 'feito' ? 'Feito' : 'Não Feito'}
          </td>
        `;
        examBody.appendChild(row);
      });

      adicionarEventos();
    }

    function adicionarEventos() {
      document.querySelectorAll('.status-cell').forEach(cell => {
        cell.addEventListener('click', async () => {
          const id = cell.getAttribute('data-id');
          const tipo = cell.getAttribute('data-type');
          const isAplicado = cell.classList.contains('applied');
          const novoStatus = isAplicado ? (tipo === 'exame' ? 'não feito' : 'não aplicado') : (tipo === 'exame' ? 'feito' : 'aplicado');

          cell.classList.toggle('applied');
          cell.classList.toggle('not-applied');
          cell.textContent = tipo === 'exame'
            ? (novoStatus === 'feito' ? 'Feito' : 'Não Feito')
            : (novoStatus === 'aplicado' ? 'Aplicado' : 'Não Aplicado');

          const endpoint = tipo === 'exame' ? API_EXAMES : API_APLICACOES;

          await fetch(`${endpoint}/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status: novoStatus })
          });
        });
      });
    }

    carregarTabelas();
  </script>
</body>
</html>
